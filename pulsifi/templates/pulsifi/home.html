<!DOCTYPE html>  <!--TODO: load from base.html-->
<html lang="en-GB">
    {% load static %}
    {% load account socialaccount %}

    <head>  <!--TODO: favicons-->
        <meta charset="utf-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Home - Pulsifi</title>
        <link href="{% static 'pulsifi/css/bootstrap.min.css' %}" rel="stylesheet" type="text/css">
    </head>

    <main>
        <nav class="navbar rounded-bottom navbar-light navbar-expand-lg pl-5 pr-5" style="background-color: #ba03fc;">   <!--TODO: load from navbar.html (only show links if logged in)-->
            <a class="navbar-brand align-middle" href="{% url 'default' %}">
                <img height=30px src="{% static 'pulsifi/brand/Logo-White_Transparent.png' %}" alt="Pulsifi Logo">
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavAltMarkup"
                    aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse justify-content-end" id="navbarNavAltMarkup">
                <div class="navbar-nav">
                    <a class="nav-link">
                        <button type="button" class="btn btn-light" id="sign-up">Sign Up</button>
                    </a>
                    <a class="nav-link">
                        <button type="button" class="btn btn-light" id="sign-in">Sign In</button>
                    </a>
                </div>
            </div>   <!--TODO: add avatar-->
        </nav>

        <div class="mx-auto" style="width: 75%">
            <div class="container-fluid p-4 text-center">
                <h1 style="color:#ba03fc">Hello! Welcome to <strong>Pulsifi</strong></h1>
                <br>
                <h3>The most <strong><em>intense</em></strong> social media platform in existence!</h3>
                <br>
                <img class="p-3" src="{% static 'pulsifi/brand/Logo-Purple_Transparent.png' %}" width=50% alt="Pulsifi Logo">   <!--TODO: remove redundant image-->
                <br>
                <h4>How does Pulsifi work?</h4>
                <br>
                <p>We augment social media, and make it more intense than accidentally eating the stray ghost chilli in your Jalfrezi.</p>
                <p>Every time you post, your post will have just 10 minutes to survive. But, for every like your post receives, your post will be blessed with an extra 2 minutes of life. For every
                   dislike
                   though, it will lose 1 minute.</p>
                <p>Once 10 minutes is up, or your post has 0 likes, it will disappear off the face of the earth.</p>
            </div>
        </div>

        <div class="modal fade" id="sign-in-modal" tabindex="-1">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="examModalLabel">Sign In</h5>
                        <button type="button" class="close" id="close-sign-in" aria-label="Close" onclick="closeModal('sign-in-modal');">
                            <span aria-hidden="true">x</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        {% get_providers as socialaccount_providers %}
                        {% if socialaccount_providers %}
                            {% for socialaccount_provider in socialaccount_providers %}
                                <!--suppress SpellCheckingInspection -->
                                <form action="{% provider_login_url socialaccount_provider.id %}" method="post">
                                    {% csrf_token %}
                                    <button class="btn text-white mb-1" type="submit" style="background-color: #ba03fc;">Log in with {% if socialaccount_provider.id == "microsoft" %}
                                                                                                                         Microsoft{% else %}
                                        {{ socialaccount_provider.name }}{% endif %}</button>
                                </form>
                            {% endfor %}
                        {% endif %}

                        <h5 class="mt-3">Or log in with a local account</h5>

                        <form id="login_form" method="post" action="{% url 'pulsifi:login_POST' %}">
                            {% if login_form.errors %}
                                <div id="form-error">
                                    <p>The operation could not be performed because one or more error(s) occurred.<br/>Please resubmit the form after making the following changes:</p>
                                    <ul>
                                        {% for field, errors in login_form.errors.items %}
                                            {% if field == "__all__" %}
                                                {% for error in errors %}
                                                    <li>{{ error|striptags }}</li>
                                                {% endfor %}
                                            {% else %}
                                                <li>{{ field|striptags|title }}:
                                                    <ul>{% for error in errors %}
                                                        <li>{{ error|striptags }}</li>{% endfor %}</ul>
                                                </li>
                                            {% endif %}
                                        {% endfor %}
                                    </ul>
                                </div>
                            {% endif %}
                            {% csrf_token %}
                            {{ login_form }}
                            {% if redirect_field_value %}
                                <input type="hidden" name="{{ redirect_field_name }}" value="{{ redirect_field_value }}">
                            {% endif %}
                            <div class="modal-footer">
                                <!--suppress SpellCheckingInspection -->
                                <a style="margin-right: 2rem;" href="{% url 'pulsifi:home' %}?action=signup{% if "next" in request.GET %}&next={{ request.GET.next|urlencode }}{% endif %}">Create a
                                                                                                                                                                                            local
                                                                                                                                                                                            account</a>
                                <button type="submit" class="btn text-white" id="sign-in-submit" style="background-color: #ba03fc;">Sign In</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="sign-up-modal" tabindex="-1">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="examModalLabel">Sign Up</h5>
                        <button type="button" class="close" id="close-sign-up" aria-label="Close" onclick="closeModal('sign-up-modal');">
                            <span aria-hidden="true">x</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form id="signup_form" method="post" action="{% url 'pulsifi:signup_POST' %}">  <!--TODO: generate form from default AuthenticationForm-->
                            {% if signup_form.errors %}
                                <div id="form-error">
                                    <p>The operation could not be performed because one or more error(s) occurred.<br/>Please resubmit the form after making the following changes:</p>
                                    <ul>
                                        {% for field, errors in signup_form.errors.items %}
                                            {% if field == "__all__" or field == "password2" %}
                                                {% for error in errors %}
                                                    <li>{{ error|striptags }}</li>
                                                {% endfor %}
                                            {% else %}
                                                <li>{% if field == "password1" %}Password{% else %}{{ field|striptags|title }}{% endif %}:
                                                    <ul>{% for error in errors %}
                                                        <li>{{ error|striptags }}</li>{% endfor %}</ul>
                                                </li>
                                            {% endif %}
                                        {% endfor %}
                                    </ul>
                                </div>
                            {% endif %}
                            {% csrf_token %}
                            {{ signup_form }}
                            {% if redirect_field_value %}
                                <input type="hidden" name="{{ redirect_field_name }}" value="{{ redirect_field_value }}">
                            {% endif %}
                            <div class="modal-footer">
                                <button type="submit" class="btn text-white" id="sign-up-submit" style="background-color: #ba03fc;">Sign Up</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal-backdrop fade show" id="backdrop" style="display: none;"></div>

        <!--suppress SpellCheckingInspection -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"
                integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3"
                crossorigin="anonymous"></script>
        <script src="{% static 'pulsifi/js/modal_controller.js' %}"></script>
        <script>
            // Get the modal
            let signup_modal = document.getElementById("sign-up");
            signup_modal.addEventListener("click", () => {
                openModal("sign-up-modal")
            });

            // Get the modal
            let signin_modal = document.getElementById("sign-in");
            signin_modal.addEventListener("click", () => {
                openModal("sign-in-modal")
            });
        </script>
        {% if request.GET.action == "login" %}
            <script>
                openModal("sign-in-modal");
            </script>
        {% elif request.GET.action == "signup" %}
            <script>
                openModal("sign-up-modal");
            </script>
        {% endif %}
    </main>
